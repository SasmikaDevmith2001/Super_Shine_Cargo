---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
---

<Layout title="Contact Us - Super Shine Cargo" description="Get in touch with Super Shine Cargo for all your logistics needs. Contact us for quotes, inquiries, and customer support">
  <Header />

  <!-- Hero Section -->
  <section class="page-hero">
    <div class="hero-overlay"></div>
    <div class="container">
      <div class="hero-content">
        <h1 class="hero-title">Contact</h1>
      </div>
    </div>
  </section>

  <main style="padding-top: 80px;">
    <!-- Hero Section -->
    <section class="contact-hero section">
      <div class="container">
        <h1 class="section-title">Contact Us</h1>
        <p class="section-subtitle">
          Ready to ship your cargo? Get in touch with our expert team for personalized logistics solutions
        </p>
      </div>
    </section>

    <!-- Contact Form & Info Section -->
    <section class="section contact-main">
      <div class="container">
        <div class="contact-content">
          <!-- Contact Form -->
          <div class="contact-form-section">
            <h2>Send Us a Message</h2>
            <p>Fill out the form below and we'll get back to you within 24 hours</p>
            
            <form class="contact-form" id="contact-form">
              <div class="form-row">
                <div class="form-group">
                  <label for="firstName">First Name *</label>
                  <input type="text" id="firstName" name="firstName" required>
                </div>
                <div class="form-group">
                  <label for="lastName">Last Name *</label>
                  <input type="text" id="lastName" name="lastName" required>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="email">Email Address *</label>
                  <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                  <label for="phone">Phone Number</label>
                  <input type="tel" id="phone" name="phone">
                </div>
              </div>
              
              <div class="form-group">
                <label for="company">Company Name</label>
                <input type="text" id="company" name="company">
              </div>
              
              <div class="form-group">
                <label for="service">Service Required *</label>
                <select id="service" name="service" required>
                  <option value="">Select a service...</option>
                  <option value="import-export">Import & Export</option>
                  <option value="customs-clearance">Customs Clearance</option>
                  <option value="air-freight">Air Freight</option>
                  <option value="sea-freight">Sea Freight</option>
                  <option value="warehousing">Warehousing</option>
                  <option value="project-cargo">Project Cargo</option>
                  <option value="other">Other</option>
                </select>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="origin">Origin Country/Port</label>
                  <input type="text" id="origin" name="origin" placeholder="Where is your cargo coming from?">
                </div>
                <div class="form-group">
                  <label for="destination">Destination</label>
                  <input type="text" id="destination" name="destination" placeholder="Where is it going?">
                </div>
              </div>
              
              <div class="form-group">
                <label for="cargoDetails">Cargo Details</label>
                <textarea id="cargoDetails" name="cargoDetails" rows="3" placeholder="Type of goods, weight, dimensions, etc."></textarea>
              </div>
              
              <div class="form-group">
                <label for="message">Additional Message *</label>
                <textarea id="message" name="message" rows="4" placeholder="Tell us more about your requirements..." required></textarea>
              </div>
              
              <button type="submit" class="btn btn-primary form-submit">Send Message</button>
            </form>
          </div>

          <!-- Contact Information -->
          <div class="contact-info-section">
            <!-- ... Existing Contact Info and Business Hours ... -->
          </div>
        </div>
      </div>
    </section>

    <!-- Quick Contact Section -->
    <!-- ... Existing Quick Contact Section ... -->

    <!-- FAQ Section -->
    <!-- ... Existing FAQ Section ... -->

  </main>

  <Footer />
</Layout>

<style>
  /* ... Your existing styles unchanged ... */
</style>

<script>
  const form = document.getElementById('contact-form');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const submitButton = form.querySelector('.form-submit');
    const originalText = submitButton.textContent;

    submitButton.textContent = 'Sending...';
    submitButton.disabled = true;

    const formData = Object.fromEntries(new FormData(form));
    const requiredFields = ['firstName', 'lastName', 'email', 'service', 'message'];

    for (const field of requiredFields) {
      if (!formData[field]) {
        alert('Please fill in all required fields.');
        submitButton.textContent = originalText;
        submitButton.disabled = false;
        return;
      }
    }

    const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL;
    const SUPABASE_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY;

    if (!SUPABASE_URL || !SUPABASE_KEY) {
      alert('Configuration error. Supabase credentials not found.');
      console.error('Missing VITE_SUPABASE_URL or VITE_SUPABASE_ANON_KEY');
      submitButton.textContent = originalText;
      submitButton.disabled = false;
      return;
    }

    // Replace with your full Supabase Edge Function URL
    const functionUrl = 'https://lwcdhsakltnxolsxpjvb.supabase.co/functions/v1/send-contact-email';

    try {
      const response = await fetch(functionUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${SUPABASE_KEY}`,
        },
        body: JSON.stringify(formData)
      });

      const result = await response.json();

      if (response.ok && result.success) {
        alert('Thank you for your message! We will get back to you within 24 hours.');
        form.reset();
      } else {
        console.error('Error response from function:', result);
        throw new Error(result.error || 'Failed to send message.');
      }

    } catch (err) {
      console.error('Fetch error:', err);
      alert('Sorry, there was an error sending your message. Please try again or contact us directly.');
    } finally {
      submitButton.textContent = originalText;
      submitButton.disabled = false;
    }
  });

  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
  });
---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
---

<Layout title="Contact Us - Super Shine Cargo" description="Get in touch with Super Shine Cargo for all your logistics needs. Contact us for quotes, inquiries, and customer support">
  <Header />

  <!-- Hero Section -->
  <section class="page-hero">
    <div class="hero-overlay"></div>
    <div class="container">
      <div class="hero-content">
        <h1 class="hero-title">Contact</h1>
      </div>
    </div>
  </section>

  <main style="padding-top: 80px;">
    <!-- Hero Section -->
    <section class="contact-hero section">
      <div class="container">
        <h1 class="section-title">Contact Us</h1>
        <p class="section-subtitle">
          Ready to ship your cargo? Get in touch with our expert team for personalized logistics solutions
        </p>
      </div>
    </section>

    <!-- Contact Form & Info Section -->
    <section class="section contact-main">
      <div class="container">
        <div class="contact-content">
          <!-- Contact Form -->
          <div class="contact-form-section">
            <h2>Send Us a Message</h2>
            <p>Fill out the form below and we'll get back to you within 24 hours</p>
            
            <form class="contact-form" id="contact-form">
              <div class="form-row">
                <div class="form-group">
                  <label for="firstName">First Name *</label>
                  <input type="text" id="firstName" name="firstName" required>
                </div>
                <div class="form-group">
                  <label for="lastName">Last Name *</label>
                  <input type="text" id="lastName" name="lastName" required>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="email">Email Address *</label>
                  <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                  <label for="phone">Phone Number</label>
                  <input type="tel" id="phone" name="phone">
                </div>
              </div>
              
              <div class="form-group">
                <label for="company">Company Name</label>
                <input type="text" id="company" name="company">
              </div>
              
              <div class="form-group">
                <label for="service">Service Required *</label>
                <select id="service" name="service" required>
                  <option value="">Select a service...</option>
                  <option value="import-export">Import & Export</option>
                  <option value="customs-clearance">Customs Clearance</option>
                  <option value="air-freight">Air Freight</option>
                  <option value="sea-freight">Sea Freight</option>
                  <option value="warehousing">Warehousing</option>
                  <option value="project-cargo">Project Cargo</option>
                  <option value="other">Other</option>
                </select>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="origin">Origin Country/Port</label>
                  <input type="text" id="origin" name="origin" placeholder="Where is your cargo coming from?">
                </div>
                <div class="form-group">
                  <label for="destination">Destination</label>
                  <input type="text" id="destination" name="destination" placeholder="Where is it going?">
                </div>
              </div>
              
              <div class="form-group">
                <label for="cargoDetails">Cargo Details</label>
                <textarea id="cargoDetails" name="cargoDetails" rows="3" placeholder="Type of goods, weight, dimensions, etc."></textarea>
              </div>
              
              <div class="form-group">
                <label for="message">Additional Message *</label>
                <textarea id="message" name="message" rows="4" placeholder="Tell us more about your requirements..." required></textarea>
              </div>
              
              <button type="submit" class="btn btn-primary form-submit">Send Message</button>
            </form>
          </div>

          <!-- Contact Information -->
          <div class="contact-info-section">
            <!-- ... Existing Contact Info and Business Hours ... -->
          </div>
        </div>
      </div>
    </section>

    <!-- Quick Contact Section -->
    <!-- ... Existing Quick Contact Section ... -->

    <!-- FAQ Section -->
    <!-- ... Existing FAQ Section ... -->

  </main>

  <Footer />
</Layout>

<style>
  /* ... Your existing styles unchanged ... */
</style>

<script>
  const form = document.getElementById('contact-form');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const submitButton = form.querySelector('.form-submit');
    const originalText = submitButton.textContent;

    submitButton.textContent = 'Sending...';
    submitButton.disabled = true;

    const formData = Object.fromEntries(new FormData(form));
    const requiredFields = ['firstName', 'lastName', 'email', 'service', 'message'];

    for (const field of requiredFields) {
      if (!formData[field]) {
        alert('Please fill in all required fields.');
        submitButton.textContent = originalText;
        submitButton.disabled = false;
        return;
      }
    }

    const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL;
    const SUPABASE_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY;

    if (!SUPABASE_URL || !SUPABASE_KEY) {
      alert('Configuration error. Supabase credentials not found.');
      console.error('Missing VITE_SUPABASE_URL or VITE_SUPABASE_ANON_KEY');
      submitButton.textContent = originalText;
      submitButton.disabled = false;
      return;
    }

    // Replace with your full Supabase Edge Function URL
    const functionUrl = 'https://lwcdhsakltnxolsxpjvb.supabase.co/functions/v1/send-contact-email';

    try {
      const response = await fetch(functionUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${SUPABASE_KEY}`,
        },
        body: JSON.stringify(formData)
      });

      const result = await response.json();

      if (response.ok && result.success) {
        alert('Thank you for your message! We will get back to you within 24 hours.');
        form.reset();
      } else {
        console.error('Error response from function:', result);
        throw new Error(result.error || 'Failed to send message.');
      }

    } catch (err) {
      console.error('Fetch error:', err);
      alert('Sorry, there was an error sending your message. Please try again or contact us directly.');
    } finally {
      submitButton.textContent = originalText;
      submitButton.disabled = false;
    }
  });

  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
  });

  console.log("Supabase URL:", import.meta.env.VITE_SUPABASE_URL);
  console.log("Supabase Key:", import.meta.env.VITE_SUPABASE_ANON_KEY?.slice(0, 10) + "...");
</script>


